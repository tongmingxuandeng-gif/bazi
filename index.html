<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>八字</title>
<style>
body { background: #1a1a1a; color: #CCCCCC; font-family: sans-serif; text-align: center; margin: 0; padding: 0; }
#four-pillars { display: flex; justify-content: center; align-items: center; margin-top: 10vh; gap: 40px; font-size: 48px; font-weight: bold; }
.pillar { display: flex; flex-direction: column; justify-content: center; align-items: center; }
#controls { margin-top: 3vh; }
button { font-size: 16px; padding: 8px 22px; font-weight: bold; background: #000000; color: #CCCCCC; border: 2px solid #444; border-radius: 6px; margin-left: 10px; }
#time { margin-top: 12px; font-size: 18px; color: #888888; }
#records { margin-top: 25px; max-height: 50vh; overflow-y: auto; padding: 0 20px; text-align: left; }
.record-item { margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 6px; display: flex; align-items: flex-start; }
.record-time { margin-right: 8px; width: 95px; font-size: 16px; line-height: 1.2; }
.record-note { font-size: 18px; color: #AAAAAA; padding: 2px 5px; margin-right: 8px; width: 90px; border: 1px solid #444; border-radius: 4px; background: #222; text-align: center; }
.record-pillars { display: flex; gap: 6px; }
</style>
</head>
<body>
<div id="four-pillars">
  <div class="pillar" id="pillar1"></div>
  <div class="pillar" id="pillar2"></div>
  <div class="pillar" id="pillar3"></div>
  <div class="pillar" id="pillar4"></div>
</div>
<div id="controls">
  <button onclick="generate()">生成</button>
  <button onclick="exportTxt()">导出记录</button>
  <div id="time"></div>
</div>
<div id="records"></div>

<script>
const wuxingColor = { wood: '#4C8A4C', fire: '#B25555', earth: '#4E4E4E', metal: '#BFBFBF', water: '#4F7DAF' };
const ganWuXing = { '甲':'wood','乙':'wood','丙':'fire','丁':'fire','戊':'earth','己':'earth','庚':'metal','辛':'metal','壬':'water','癸':'water' };
const zhiWuXing = { '子':'water','丑':'earth','寅':'wood','卯':'wood','辰':'earth','巳':'fire','午':'fire','未':'earth','申':'metal','酉':'metal','戌':'earth','亥':'water' };
const jiazi = ["甲子","乙丑","丙寅","丁卯","戊辰","己巳","庚午","辛未","壬申","癸酉","甲戌","乙亥","丙子","丁丑","戊寅","己卯","庚辰","辛巳","壬午","癸未","甲申","乙酉","丙戌","丁亥","戊子","己丑","庚寅","辛卯","壬辰","癸巳","甲午","乙未","丙申","丁酉","戊戌","己亥","庚子","辛丑","壬寅","癸卯","甲辰","乙巳","丙午","丁未","戊申","己酉","庚戌","辛亥","壬子","癸丑","甲寅","乙卯","丙辰","丁巳","戊午","己未","庚申","辛酉","壬戌","癸亥"];

function colorize(p){ const g=p[0],z=p[1]; return `<span style="color:${wuxingColor[ganWuXing[g]]}">${g}</span><span style="color:${wuxingColor[zhiWuXing[z]]}">${z}</span>`; }

function generate(){
  const arr=[]; for(let i=0;i<4;i++) arr.push(jiazi[Math.random()*jiazi.length|0]);
  for(let i=0;i<4;i++) document.getElementById('pillar'+(i+1)).innerHTML=colorize(arr[i]);
  const now=new Date();
  const d=`${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;
  const t=`${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
  document.getElementById('time').textContent=d+" "+t;
  const records=JSON.parse(localStorage.getItem('records')||'[]');
  records.unshift({date:d,time:t,pillars:arr,note:''});
  localStorage.setItem('records',JSON.stringify(records));
  loadRecords();
}

function loadRecords(){
  const records=JSON.parse(localStorage.getItem('records')||'[]');
  const box=document.getElementById('records');
  box.innerHTML=records.map((r,i)=>`
    <div class="record-item" data-index="${i}">
      <div class="record-time">${r.date}<br>${r.time}</div>
      <input class="record-note" value="${r.note||''}" />
      <div class="record-pillars">${r.pillars.map(p=>`<div class="pillar">${colorize(p)}</div>`).join('')}</div>
    </div>
  `).join('');

  document.querySelectorAll('.record-note').forEach(input=>{
    input.addEventListener('blur',()=>{
      const idx=input.closest('.record-item').dataset.index;
      const records=JSON.parse(localStorage.getItem('records')||'[]');
      records[idx].note=input.value;
      localStorage.setItem('records',JSON.stringify(records));
    });
  });
}

function exportTxt(){
  const records=JSON.parse(localStorage.getItem('records')||'[]');
  let content='';
  records.forEach(r=>{
    content+=`${r.date} ${r.time} ${r.pillars.join(' ')} ${r.note}\n`;
  });
  const blob=new Blob([content],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='八字记录.txt';
  a.click();
  URL.revokeObjectURL(url);
}

loadRecords();
</script>
</body>
</html>
